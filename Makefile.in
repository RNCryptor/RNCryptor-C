##
# Makefile automatically generated by genmake 1.0, Feb-11-2014 
# genmake 1.0 by muquit@muquit.com, http://www.muquit.com/
##
srcdir = @srcdir@
VPATH = @srcdir@
top_srcdir = @top_srcdir@
CC= @CC@
DEFS= @DEFS@ -DUNIX
AR= @AR@
ARFLAGS = @ARFLAGS@
RANLIB= @RANLIB@
LIBNAME= librncryptorc.@A@
PROGNAME= 
INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@
INSTALL_EXEC = @INSTALL_EXEC@

DESTDIR = 
prefix = @prefix@
exec_prefix = @exec_prefix@
datarootdir = @datarootdir@
datadir = @datadir@
bindir = @bindir@
includedir = @includedir@
libdir = @libdir@
mandir = @mandir@
man1dir = $(mandir)/man1
BINDIR = $(DESTDIR)$(bindir)
MAN1DIR = $(DESTDIR)$(man1dir)

MANPAGE= 

OPENSSL_DIR=@OPENSSL_DIR@
OPENSSL_INC=@OPENSSL_INC@
OPENSSL_LIBS=@OPENSSL_LIBS@ @DL_LIB@

STRIP=@STRIP@

INCLUDES=  -I. $(OPENSSL_INC)

DEFINES= $(INCLUDES) $(DEFS) -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 \
	-DHAVE_MATH_H=1

CFLAGS= @CFLAGS@ $(DEFINES)
LIBS=$(LIBNAME) $(OPENSSL_LIBS)

SRCS = rncryptor_c.c mutils.c
OBJS = rncryptor_c.o mutils.o

.c.o:
	rm -f $@
	$(CC) $(CFLAGS) -c $*.c

all: $(LIBNAME) examples

$(LIBNAME) : $(OBJS)
	rm -f $@
	$(AR) $(ARFLAGS) $@ $(OBJS)
	$(RANLIB) $@

examples: $(LIBNAME)
	$(CC) $(CFLAGS) rn_decrypt.c -o rn_decrypt $(LIBS)
	$(CC) $(CFLAGS) rn_encrypt.c -o rn_encrypt $(LIBS)
	$(CC) $(CFLAGS) rn_encrypt_with_key.c -o rn_encrypt_with_key $(LIBS)
	$(CC) $(CFLAGS) rn_decrypt_with_key.c -o rn_decrypt_with_key $(LIBS)


# Generate the C code from RNCryptor's test vectors
gen_tester:
	(cd tests;./GenVectorTests-C.rb -o test_with_test_vectors.c test_vectors)
	$(CC) $(CFLAGS) tests/test_with_test_vectors.c -o tests/test_with_test_vectors $(LIBS)

# sanity test
test_simple:examples
	+ruby tests/test.rb

# test code must be pre-generated with target gen_test_vector_code
# we use the test in windows as well but code is generated in Unix with ruby
test:gen_tester
	tests/test_with_test_vectors

install: installdirs install-all

install-man:
	$(INSTALL_DATA) $(MANPAGE) $(MAN1DIR)

installdirs:
	$(SHELL) ${top_srcdir}/mkinstalldirs ${DESTDIR}${includedir}
	$(SHELL) ${top_srcdir}/mkinstalldirs ${DESTDIR}${bindir}
	$(SHELL) ${top_srcdir}/mkinstalldirs ${DESTDIR}${libdir}

install-all:
	$(INSTALL_DATA) rncryptor_c.h ${DESTDIR}${includedir}
	$(INSTALL_DATA) $(LIBNAME) ${DESTDIR}${libdir}
	$(INSTALL_PROGRAM) rn_decrypt ${DESTDIR}${bindir}
	$(INSTALL_PROGRAM) rn_decrypt_with_key ${DESTDIR}${bindir}
	$(INSTALL_PROGRAM) rn_encrypt ${DESTDIR}${bindir}
	$(INSTALL_PROGRAM) rn_encrypt_with_key ${DESTDIR}${bindir}

clean:
	rm -f $(OBJS) *.o $(LIBNAME) rn_encrypt rn_decrypt rn_encrypt_with_key rn_decrypt_with_key \
		tests/test_with_test_vectors
